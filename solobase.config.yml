# Solobase Management Platform Configuration
# This configuration runs the SaaS management platform that provisions customer instances

# Server Configuration
server:
  host: 0.0.0.0
  port: 8090
  url: https://manage.solobase.cloud

# Database Configuration
database:
  type: postgres
  host: ${DATABASE_HOST}
  port: 5432
  name: solobase_management
  user: ${DATABASE_USER}
  password: ${DATABASE_PASSWORD}
  ssl_mode: require
  max_connections: 20

# Authentication Configuration
auth:
  jwt_secret: ${JWT_SECRET}
  token_expiry: 3600          # 1 hour
  refresh_token_expiry: 2592000  # 30 days
  bcrypt_cost: 12

  # Email verification
  email_verification_required: true
  email_verification_expiry: 86400  # 24 hours

  # Rate limiting
  rate_limit:
    login_attempts: 5
    login_window: 900  # 15 minutes

  # Default admin account
  default_admin:
    email: ${ADMIN_EMAIL}
    password: ${ADMIN_PASSWORD}
    name: "Administrator"

# Email Configuration
email:
  provider: smtp
  smtp:
    host: ${SMTP_HOST}
    port: 587
    username: ${SMTP_USERNAME}
    password: ${SMTP_PASSWORD}
    from: noreply@solobase.cloud
    from_name: Solobase

# Storage Configuration
storage:
  provider: local
  local:
    path: ./storage

# Extensions Configuration
extensions:
  # Products Extension (Built-in with Stripe)
  products:
    enabled: true

    # Stripe Payment Provider
    provider: stripe
    stripe_secret_key: ${STRIPE_SECRET_KEY}
    stripe_webhook_secret: ${STRIPE_WEBHOOK_SECRET}
    stripe_publishable_key: ${STRIPE_PUBLISHABLE_KEY}

    # Product Types
    product_types:
      - name: subscription_plan
        description: "Solobase subscription plans"
        fields:
          - name: price
            type: number
            required: true
          - name: interval
            type: string
            required: true
            options: [month, year]
          - name: features
            type: array
            required: true
          - name: quotas
            type: object
            required: true

      - name: instance
        description: "Customer Solobase instances"
        fields:
          - name: subdomain
            type: string
            required: true
            unique: true
          - name: status
            type: string
            required: true
            options: [provisioning, running, error, suspended, terminated]
          - name: plan_id
            type: string
            required: true
          - name: resources
            type: object
            required: false
          - name: quotas
            type: object
            required: true
          - name: url
            type: string
            required: false

    # Checkout Configuration
    checkout:
      success_url: https://manage.solobase.cloud/dashboard?session_id={CHECKOUT_SESSION_ID}
      cancel_url: https://manage.solobase.cloud/pricing

    # Webhook Configuration
    webhooks:
      enabled: true
      endpoint: /api/webhooks/stripe
      events:
        - checkout.session.completed
        - customer.subscription.created
        - customer.subscription.updated
        - customer.subscription.deleted
        - invoice.paid
        - invoice.payment_failed

  # Instance Provisioner Extension (Custom)
  instance-provisioner:
    enabled: true

    # AWS Configuration
    aws_region: us-east-1
    aws_access_key_id: ${AWS_ACCESS_KEY_ID}
    aws_secret_access_key: ${AWS_SECRET_ACCESS_KEY}

    # Backblaze B2 Configuration
    b2_key_id: ${B2_KEY_ID}
    b2_app_key: ${B2_APP_KEY}

    # Shared RDS Configuration
    shared_rds_endpoint: ${SHARED_RDS_ENDPOINT}
    shared_rds_master_user: ${SHARED_RDS_MASTER_USER}
    shared_rds_master_pass: ${SHARED_RDS_MASTER_PASS}

    # Lambda Configuration
    solobase_binary_s3_bucket: solobase-lambda-binaries
    lambda_memory_size: 512
    lambda_timeout: 30

    # CloudFront Configuration
    cloudfront_key_pair_id: ${CLOUDFRONT_KEY_PAIR_ID}
    cloudfront_private_key: ${CLOUDFRONT_PRIVATE_KEY}

    # Domain Configuration
    base_domain: solobase.cloud

    # Health Check Configuration
    health_check_enabled: true
    health_check_interval: 300  # 5 minutes
    health_check_timeout: 10

# Logging Configuration
logging:
  level: info
  format: json
  output: stdout

  # Log to file
  file:
    enabled: true
    path: ./logs/solobase.log
    max_size: 100  # MB
    max_backups: 10
    max_age: 30  # days

# Security Configuration
security:
  cors:
    enabled: true
    allowed_origins:
      - https://manage.solobase.cloud
      - https://solobase.cloud
    allowed_methods: [GET, POST, PUT, DELETE, PATCH, OPTIONS]
    allowed_headers: [Authorization, Content-Type]

  # Rate Limiting
  rate_limit:
    enabled: true
    requests_per_minute: 60
    burst: 100

  # CSRF Protection
  csrf:
    enabled: true
    secret: ${CSRF_SECRET}

# Monitoring Configuration
monitoring:
  enabled: true

  # Prometheus metrics
  prometheus:
    enabled: true
    endpoint: /metrics

  # Health check endpoint
  health:
    enabled: true
    endpoint: /health

# Feature Flags
features:
  # Enable dashboard UI
  dashboard: true

  # Enable API documentation
  api_docs: true
  api_docs_path: /api/docs

  # Enable user registration
  user_registration: true

  # Enable 2FA
  two_factor_auth: false

# Development Settings
development:
  debug: false
  hot_reload: false

# Backup Configuration
backup:
  enabled: true
  schedule: "0 2 * * *"  # Daily at 2 AM
  retention_days: 30
  s3_bucket: ${BACKUP_S3_BUCKET}
